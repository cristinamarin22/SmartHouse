@model IEnumerable<SmartHouse.Models.MotionDetectionData>

@{
    ViewBag.Title = "MotionDetection";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
</head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
    html, body, h1, h2, h3, h4, h5 {
        font-family: "Raleway", sans-serif;
    }

    table {
        border-collapse: collapse;
        width: 100%;
    }

    th, td {
        text-align: left;
        padding: 8px;
    }

    tr:nth-child(even) {
        background-color: #f2f2f2
    }

    th {
        background-color: #2b92f2;
        color: white;
    }

    .button {
        background-color: #4CAF50; /* Green */
        border: none;
        color: white;
        padding: 10px 20px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin: 4px 2px;
        -webkit-transition-duration: 0.4s; /* Safari */
        transition-duration: 0.4s;
        cursor: pointer;
    }

    .button3 {
        background-color: white;
        color: black;
        border: 2px solid #2b92f2;
    }

        .button3:hover {
            background-color: #2b92f2;
            color: white;
        }
</style>
<body>
    <div class="w3-container">

        <button type="button" class="button button3" id="refreshButton" onclick="getHistoryData()">History data</button>

        <table class="table" id="tableMotionDetection">
            <tr>
                <th>
                    Date
                </th>
                <th>
                    Action
                </th>
            </tr>

            @foreach (var item in Model)
            {
                <tr>
                    <td>
                        @Html.DisplayFor(modelItem => item.InternalTime)
                    </td>
                    <td>
                        @Html.ActionLink("Delete", "DeleteMotionDetection", "Home", new { id = item.Id }, null)
                    </td>
                </tr>
            }

        </table><br>
    </div>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script type="text/javascript" charset="utf8" src="/js/jquery.dataTables.js"></script>

    <script type="text/javascript">

        function getHistoryData() {
            $.ajax({
                url: '@Url.Action("GetMotionDetectionHistoryData", "Home")',
                method: 'GET',
                dataType: 'json',
                success: function (data) {
                    $('#tableMotionDetection tr>td').remove();
                    var html = '';
                    for (var i = 0; i < data.length; i++) {
                        html += '<tr><td>' + new Date(data[i].InternalTime.match(/\d+/).map(Number)[0]).toLocaleString() + '</td></tr>';
                    }

                    $("#tableMotionDetection").find('tbody').append($(html));
              }
           });
        }

        setInterval(getHistoryData, 10000);

    </script>
</body>
</html>

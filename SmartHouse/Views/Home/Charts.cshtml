@model SmartHouse.Models.TemperatureHumidityData

@{
    ViewBag.Title = "Charts";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!DOCTYPE HTML>
<html>
<head>
    <script src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
    <script src="https://canvasjs.com/assets/script/jquery.canvasjs.min.js"></script>
    @*<script src="http://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>*@

    <script type="text/javascript" src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
    <script type="text/javascript" src="http://ticket-compare.com/wp-content/themes/ticket-compare/js/jquery.canvasjs.min.js"></script>
    <script src="~/Scripts/jquery.canvasjs.min.js"></script>
    <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>

    <script type="text/javascript">
        window.onload = function () {

            //var today = '0' + (new Date($.now()).getMonth() + 1).toString() + '-' + new Date($.now()).getDate().toString() + '-' + new Date($.now()).getFullYear().toString().toString();
            //$('#TemperatureEvolutionDateTextBox').val(today);

            // Initial Values
            var dataPoints = [];
            var xValue = 0;
            var yValue = 10;
            var newDataCount = 6;
            var dateChanged = false;
            var chartTitle = "Temperature evolution today";

            var chart = new CanvasJS.Chart("chartTemperatureEvolutionToday", {
                theme: "light2",
                zoomEnabled: true,
                zoomType: "xy",
                animationEnabled: true,
                title: {
                    text: chartTitle
                },
                toolTip: {
                    enabled: true,
                    contentFormatter: function (e) {
                        return "Temperature: " + e.entries[0].dataPoint.y + "°C <br>Hour: " + e.entries[0].dataPoint.x.toLocaleTimeString('en-GB') + "<br>Date: " + e.entries[0].dataPoint.x.toLocaleDateString('en-GB');
                    }
                },
                axisX: {
                    title: "Time",
                    intervalType: "minute",
                    interval: 30,
                    valueFormatString: "H:mm"
                },
                axisY: {
                    title: "Temperature (in °C)"
                },
                data: [{
                    type: "spline",
                    dataPoints: dataPoints
                }]
            });
            updateData();

            function addData(data) {
                $.each(data, function (key, value) {
                    if (key == xValue) {
                        dataPoints.push({ x: new Date(new Date(value.x).getFullYear(), new Date(value.x).getMonth(), new Date(value.x).getDate(), new Date(value.x).getHours(), new Date(value.x).getMinutes(), new Date(value.x).getSeconds()), y: value.y });
                        xValue++;
                        yValue = parseInt(value[1]);
                    }
                });

                chart.render();
            }

            function updateData() {

                if (dateChanged) {

                    clearTimeout();

                    var filter = {
                        "DateMinValue": $('#TemperatureEvolutionDateTextBox').val()
                    };

                    $.ajax({
                        url: '@Url.Action("JSONTemperatureChartAnotherDay", "Home")',
                        method: 'GET',
                        data: filter,
                        dataType: 'json',
                        success: function (response) {
                            addData(response);
                        }
                    });
                }
                else {
                    setTimeout(updateData, 1500);

                    $.get("/home/JSONTemperatureChartToday", function (data) {
                        addData(data);
                    });
                }
            }

            $('#TemperatureEvolutionDateTextBox').change(function () {
                // Initial Values
                xValue = 0;
                yValue = 10;
                newDataCount = 6;
                dataPoints = [];
                setTimeout(updateData, 1500);

                var date = $('#TemperatureEvolutionDateTextBox').val();

                if (date == '') {
                    dateChanged = false;
                    chartTitle = "Temperature evolution today";
                }
                else {
                    dateChanged = true;
                    chartTitle = "Temperature evolution on " + new Date(date).toLocaleDateString('en-GB');
                }

                chart = new CanvasJS.Chart("chartTemperatureEvolutionToday", {
                    theme: "light2",
                    zoomEnabled: true,
                    zoomType: "xy",
                    animationEnabled: true,
                    title: {
                        text: chartTitle
                    },
                    toolTip: {
                        enabled: true,
                        contentFormatter: function (e) {
                            return "Temperature: " + e.entries[0].dataPoint.y + "°C <br>Hour: " + e.entries[0].dataPoint.x.toLocaleTimeString('en-GB') + "<br>Date: " + e.entries[0].dataPoint.x.toLocaleDateString('en-GB');
                        }
                    },
                    axisX: {
                        title: "Time",
                        intervalType: "minute",
                        interval: 30,
                        valueFormatString: "H:mm"
                    },
                    axisY: {
                        title: "Temperature (in °C)"
                    },
                    data: [{
                        type: "spline",
                        dataPoints: dataPoints
                    }]
                });
            });

        }
    </script>
</head>
<body>
    <div class="w3-row-padding w3-margin-bottom">
        <label><span>Date </span></label>

        @Html.TextBox("TemperatureEvolutionDate", "", new { id = "TemperatureEvolutionDateTextBox", style = "width:150px; background:#7f9be7", @type = "date" })

        <div id="chartTemperatureEvolutionToday" style="height: 370px; width: 100%;"></div>
    </div>
</body>
</html>


@*<script>
        window.onload = function () {

        var chart = new CanvasJS.Chart("chartContainer", {
            animationEnabled: true,
            title:{
                text: "Temperature evolution"
            },
            axisX:{
                valueFormatString: "DD MMM",
                title: "time",
                intervalType: "hour",
                interval: 1,
                valueFormatString: "hh TT K"
            },
            axisY: {
                title: "Temperature"
            },
            data: [{
                type: "line",
                color: "#F08080",
                dataPoints: [
                    { x: new Date(2017, 0, 1), y: 610 },
                    { x: new Date(2017, 0, 2), y: 680 },
                    { x: new Date(2017, 0, 3), y: 690 },
                    { x: new Date(2017, 0, 4), y: 700 },
                    { x: new Date(2017, 0, 5), y: 710 },
                    { x: new Date(2017, 0, 6), y: 658 },
                    { x: new Date(2017, 0, 7), y: 734 },
                    { x: new Date(2017, 0, 8), y: 963 },
                    { x: new Date(2017, 0, 9), y: 847 },
                    { x: new Date(2017, 0, 10), y: 853 },
                    { x: new Date(2017, 0, 11), y: 869 },
                    { x: new Date(2017, 0, 12), y: 943 },
                    { x: new Date(2017, 0, 13), y: 970 },
                    { x: new Date(2017, 0, 14), y: 869 },
                    { x: new Date(2017, 0, 15), y: 890 },
                    { x: new Date(2017, 0, 16), y: 930 },
                    { x: new Date(2017, 0, 17), y: 1850 },
                    { x: new Date(2017, 0, 18), y: 1905 },
                    { x: new Date(2017, 0, 19), y: 1980 },
                    { x: new Date(2017, 0, 20), y: 1858 },
                    { x: new Date(2017, 0, 21), y: 1034 },
                    { x: new Date(2017, 0, 22), y: 963 },
                    { x: new Date(2017, 0, 23), y: 847 },
                    { x: new Date(2017, 0, 24), y: 853 },
                    { x: new Date(2017, 0, 25), y: 869 },
                    { x: new Date(2017, 0, 26), y: 943 },
                    { x: new Date(2017, 0, 27), y: 970 },
                    { x: new Date(2017, 0, 28), y: 869 },
                    { x: new Date(2017, 0, 29), y: 890 },
                    { x: new Date(2017, 0, 30), y: 930 },
                    { x: new Date(2017, 0, 31), y: 750 }
                ]
            }]
        });
        chart.render();
    }
    </script>*@


@*<script type="text/javascript">

            var dataPoints = [], chart;

            $.get("/home/GetChartsInfo", function (data) {
                dataPoints = data;

                var lowestY = Number.POSITIVE_INFINITY;
                var highestY = Number.NEGATIVE_INFINITY;
                var yValue;

                for (var i = dataPoints.length - 1; i >= 0; i--) {
                    yValue = dataPoints[i].y;
                    if (yValue < lowestY) lowestY = yValue;
                    if (yValue > highestY) highestY = yValue;

                    //chart.data[0].addTo("dataPoints", { x: new Date(Date.UTC( )), y: Math.random() * (100 - 10) + 10 });
                }

                chart = new CanvasJS.Chart("chartContainer", {
                title: {
                    text: "Temperature evolution"
                },
                zoomEnabled: true,
                zoomType: "xy",
                animationEnabled: true,
                axisX: {
                title: "Hour",
                gridThickness: 2,
                interval: 2,
                intervalType: "hour",
                valueFormatString: "hh TT K",
                labelAngle: -20
                },
                axisY: {
                    includeZero: true,
                    title: "Temperature",
                    minimum: lowestY-1,
                    maximum: highestY+1
                },
                toolTip: {
                    shared: true,
                    content: "<span style='\"'color: {color};'\"'><strong>{name}</strong></span> <span style='\"'color: dimgrey;'\"'>{y}</span> "
                },
                legend: {
                    fontSize: 13
                },
                data: [

                    {
                        type: "line",
                        dataPoints: [//array
                            { x: new Date(Date.UTC(2012, 01, 1, 1, 0)), y: 26 },
                            { x: new Date(Date.UTC(2012, 01, 1, 2, 0)), y: 38 },
                            { x: new Date(Date.UTC(2012, 01, 1, 3, 0)), y: 43 },
                            { x: new Date(Date.UTC(2012, 01, 1, 4, 0)), y: 29 },
                            { x: new Date(Date.UTC(2012, 01, 1, 5, 0)), y: 41 },
                            { x: new Date(Date.UTC(2012, 01, 1, 6, 0)), y: 54 },
                            { x: new Date(Date.UTC(2012, 01, 1, 7, 0)), y: 66 },
                            { x: new Date(Date.UTC(2012, 01, 1, 8, 0)), y: 60 },
                            { x: new Date(Date.UTC(2012, 01, 1, 9, 0)), y: 53 },
                            { x: new Date(Date.UTC(2012, 01, 1, 10, 0)), y: 60 }
                        ]
                    }

                    //{
                    //    type: "line",
                    //    showInLegend: true,
                    //    name: "Temperature",
                    //    markerSize: 0,
                    //    color: "rgba(54,158,173,.6)",
                    //    dataPoints: dataPoints
                    //}
                ]
            });

            chart.render();
            });

            function updateChart() {
                $.get("/home/JSONTemperatureChart", function (data) {
                    $.each(data, function (index) {
                        dataPoints.push(data[index]);
                    });
                    chart.render();
                    setTimeout(function () { updateChart() }, 1000);
                });
            }
        </script>
    </body>
    </html>*@
